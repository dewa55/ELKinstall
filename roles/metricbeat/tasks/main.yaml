---
#
# Instaling and configuring MetricBeat
#

- name: Install metricbeat
  yum:
    name: metricbeat
    state: present

# - name: Enable modules apache and mysql
#   shell: metricbeat modules enable apache mysql

- name: Set elasticsearch output
  blockinfile:
      path: /etc/metricbeat/metricbeat.yml
      username: kibana
      password: 

- name: Set kibana output
  lineinfile:
      destfile: /etc/metricbeat/metricbeat.yml
      regexp: 'setup.kibana:'
      line: 'host: "localhost:5601"'

- name: Set logstash output
  lineinfile:
      destfile: /etc/metricbeat/metricbeat.yml
      regexp: 'output.logstash:'
      line: 'output.logstash:'
  with_items:
    - { regexp: 'output.logstash:', line: 'output.logstash:' }
    - { regexp: 'hosts: ["localhost:5044"]', line: 'hosts: ["localhost:5044"]' }
